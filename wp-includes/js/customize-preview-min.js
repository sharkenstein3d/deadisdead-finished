!function(e,$){var t=wp.customize,n,i={};!function(e){var n;e.replaceState&&(n=function(e){var n,i,s;return n=document.createElement("a"),n.href=e,i=t.utils.parseQueryString(location.search.substr(1)),s=t.utils.parseQueryString(n.search.substr(1)),s.customize_changeset_uuid=i.customize_changeset_uuid,i.customize_theme&&(s.customize_theme=i.customize_theme),i.customize_messenger_channel&&(s.customize_messenger_channel=i.customize_messenger_channel),n.search=$.param(s),n.href},e.replaceState=function(t){return function s(r,a,o){return i=r,t.call(e,r,a,"string"==typeof o&&o.length>0?n(o):o)}}(e.replaceState),e.pushState=function(t){return function s(r,a,o){return i=r,t.call(e,r,a,"string"==typeof o&&o.length>0?n(o):o)}}(e.pushState),window.addEventListener("popstate",function(e){i=e.state}))}(history),n=function(e,t,n){var i;return function(){var s=arguments;n=n||this,clearTimeout(i),i=setTimeout(function(){i=null,e.apply(n,s)},t)}},t.Preview=t.Messenger.extend({initialize:function(e,i){var s=this,r=document.createElement("a");t.Messenger.prototype.initialize.call(s,e,i),r.href=s.origin(),s.add("scheme",r.protocol.replace(/:$/,"")),s.body=$(document.body),s.window=$(window),t.settings.channel&&(s.body.on("click.preview","a",function(e){s.handleLinkClick(e)}),s.body.on("submit.preview","form",function(e){s.handleFormSubmit(e)}),s.window.on("scroll.preview",n(function(){s.send("scroll",s.window.scrollTop())},200)),s.bind("scroll",function(e){s.window.scrollTop(e)}))},handleLinkClick:function(e){var n=this,i,s;if(i=$(e.target).closest("a"),!_.isUndefined(i.attr("href"))&&!(s="#"===i.attr("href").substr(0,1))&&/^https?:$/.test(i.prop("protocol"))){if(!t.isLinkPreviewable(i[0]))return wp.a11y.speak(t.settings.l10n.linkUnpreviewable),void e.preventDefault();e.preventDefault(),e.shiftKey||n.send("url",i.prop("href"))}},handleFormSubmit:function(e){var n=this,i,s;if(i=document.createElement("a"),s=$(e.target),i.href=s.prop("action"),"GET"!==s.prop("method").toUpperCase()||!t.isLinkPreviewable(i))return wp.a11y.speak(t.settings.l10n.formUnpreviewable),void e.preventDefault();e.isDefaultPrevented()||(i.search.length>1&&(i.search+="&"),i.search+=s.serialize(),n.send("url",i.href)),e.preventDefault()}}),t.addLinkPreviewing=function e(){var n="a[href], area";$(document.body).find("a[href], area").each(function(){t.prepareLinkPreview(this)}),"undefined"!=typeof MutationObserver?(t.mutationObserver=new MutationObserver(function(e){_.each(e,function(e){$(e.target).find("a[href], area").each(function(){t.prepareLinkPreview(this)})})}),t.mutationObserver.observe(document.documentElement,{childList:!0,subtree:!0})):$(document.documentElement).on("click focus mouseover","a[href], area",function(){t.prepareLinkPreview(this)})},t.isLinkPreviewable=function e(n,i){var s,r,a,o;return a=_.extend({},{allowAdminAjax:!1},i||{}),"javascript:"===n.protocol||("https:"===n.protocol||"http:"===n.protocol)&&(o=n.host.replace(/:(80|443)$/,""),r=document.createElement("a"),!!(s=!_.isUndefined(_.find(t.settings.url.allowed,function(e){return r.href=e,r.protocol===n.protocol&&r.host.replace(/:(80|443)$/,"")===o&&0===n.pathname.indexOf(r.pathname.replace(/\/$/,""))})))&&(!/\/wp-(login|signup)\.php$/.test(n.pathname)&&(/\/wp-admin\/admin-ajax\.php$/.test(n.pathname)?a.allowAdminAjax:!/\/wp-(admin|includes|content)(\/|$)/.test(n.pathname))))},t.prepareLinkPreview=function e(n){var i;if(!$(n).closest("#wpadminbar").length&&"#"!==$(n).attr("href").substr(0,1)&&/^https?:$/.test(n.protocol)){if(t.settings.channel&&"https"===t.preview.scheme.get()&&"http:"===n.protocol&&-1!==t.settings.url.allowedHosts.indexOf(n.host)&&(n.protocol="https:"),!t.isLinkPreviewable(n))return void(t.settings.channel&&$(n).addClass("customize-unpreviewable"));$(n).removeClass("customize-unpreviewable"),i=t.utils.parseQueryString(n.search.substring(1)),i.customize_changeset_uuid=t.settings.changeset.uuid,t.settings.theme.active||(i.customize_theme=t.settings.theme.stylesheet),t.settings.channel&&(i.customize_messenger_channel=t.settings.channel),n.search=$.param(i),t.settings.channel&&(n.target="_self")}},t.addRequestPreviewing=function e(){var n=function(e,n,i){var s,r,a,o={};s=document.createElement("a"),s.href=e.url,t.isLinkPreviewable(s,{allowAdminAjax:!0})&&(r=t.utils.parseQueryString(s.search.substring(1)),t.each(function(e){e._dirty&&(o[e.id]=e.get())}),_.isEmpty(o)||(a=e.type.toUpperCase(),"POST"!==a&&(i.setRequestHeader("X-HTTP-Method-Override",a),r._method=a,e.type="POST"),e.data?e.data+="&":e.data="",e.data+=$.param({customized:JSON.stringify(o)})),r.customize_changeset_uuid=t.settings.changeset.uuid,t.settings.theme.active||(r.customize_theme=t.settings.theme.stylesheet),s.search=$.param(r),e.url=s.href)};$.ajaxPrefilter(n)},t.addFormPreviewing=function e(){$(document.body).find("form").each(function(){t.prepareFormPreview(this)}),"undefined"!=typeof MutationObserver&&(t.mutationObserver=new MutationObserver(function(e){_.each(e,function(e){$(e.target).find("form").each(function(){t.prepareFormPreview(this)})})}),t.mutationObserver.observe(document.documentElement,{childList:!0,subtree:!0}))},t.prepareFormPreview=function e(n){var i,s={};if(n.action||(n.action=location.href),i=document.createElement("a"),i.href=n.action,t.settings.channel&&"https"===t.preview.scheme.get()&&"http:"===i.protocol&&-1!==t.settings.url.allowedHosts.indexOf(i.host)&&(i.protocol="https:",n.action=i.href),"GET"!==n.method.toUpperCase()||!t.isLinkPreviewable(i))return void(t.settings.channel&&$(n).addClass("customize-unpreviewable"));$(n).removeClass("customize-unpreviewable"),s.customize_changeset_uuid=t.settings.changeset.uuid,t.settings.theme.active||(s.customize_theme=t.settings.theme.stylesheet),t.settings.channel&&(s.customize_messenger_channel=t.settings.channel),_.each(s,function(e,t){var i=$(n).find('input[name="'+t+'"]');i.length?i.val(e):$(n).prepend($("<input>",{type:"hidden",name:t,value:e}))}),t.settings.channel&&(n.target="_self")},t.keepAliveCurrentUrl=function(){var e=location.pathname,n=location.search.substr(1),i=null,s=["customize_theme","customize_changeset_uuid","customize_messenger_channel"];return function r(){var a,o;if(n===location.search.substr(1)&&e===location.pathname)return void t.preview.send("keep-alive");a=document.createElement("a"),null===i&&(a.search=n,i=t.utils.parseQueryString(n),_.each(s,function(e){delete i[e]})),a.href=location.href,o=t.utils.parseQueryString(a.search.substr(1)),_.each(s,function(e){delete o[e]}),e===location.pathname&&_.isEqual(i,o)?t.preview.send("keep-alive"):(a.search=$.param(o),a.hash="",t.settings.url.self=a.href,t.preview.send("ready",{currentUrl:t.settings.url.self,activePanels:t.settings.activePanels,activeSections:t.settings.activeSections,activeControls:t.settings.activeControls,settingValidities:t.settings.settingValidities})),i=o,n=location.search.substr(1),e=location.pathname}}(),t.settingPreviewHandlers={custom_logo:function(e){$("body").toggleClass("wp-custom-logo",!!e)},custom_css:function(e){$("#wp-custom-css").text(e)},background:function(){var e="",n={};_.each(["color","image","preset","position_x","position_y","size","repeat","attachment"],function(e){n[e]=t("background_"+e)}),$(document.body).toggleClass("custom-background",!(!n.color()&&!n.image())),n.color()&&(e+="background-color: "+n.color()+";"),n.image()&&(e+='background-image: url("'+n.image()+'");',e+="background-size: "+n.size()+";",e+="background-position: "+n.position_x()+" "+n.position_y()+";",e+="background-repeat: "+n.repeat()+";",e+="background-attachment: "+n.attachment()+";"),$("#custom-background-css").text("body.custom-background { "+e+" }")}},$(function(){var e,n;t.settings=window._wpCustomizeSettings,t.settings&&(t.preview=new t.Preview({url:window.location.href,channel:t.settings.channel}),t.addLinkPreviewing(),t.addRequestPreviewing(),t.addFormPreviewing(),n=function(e,n,i){var s=t(e);s?s.set(n):(i=i||!1,s=t.create(e,n,{id:e}),i&&(s._dirty=!0))},t.preview.bind("settings",function(e){$.each(e,n)}),t.preview.trigger("settings",t.settings.values),$.each(t.settings._dirty,function(e,n){var i=t(n);i&&(i._dirty=!0)}),t.preview.bind("setting",function(e){var t=!0;n.apply(null,e.concat(!0))}),t.preview.bind("sync",function(e){e.settings&&e["settings-modified-while-loading"]&&_.each(_.keys(e.settings),function(n){t.has(n)&&!e["settings-modified-while-loading"][n]&&delete e.settings[n]}),$.each(e,function(e,n){t.preview.trigger(e,n)}),t.preview.send("synced")}),t.preview.bind("active",function(){t.preview.send("nonce",t.settings.nonce),t.preview.send("documentTitle",document.title),t.preview.send("scroll",$(window).scrollTop())}),t.preview.bind("saved",function(e){e.next_changeset_uuid&&(t.settings.changeset.uuid=e.next_changeset_uuid,$(document.body).find("a[href], area").each(function(){t.prepareLinkPreview(this)}),$(document.body).find("form").each(function(){t.prepareFormPreview(this)}),history.replaceState&&history.replaceState(i,"",location.href)),t.trigger("saved",e)}),t.preview.bind("changeset-saved",function(e){_.each(e.saved_changeset_values,function(e,n){var i=t(n);i&&_.isEqual(i.get(),e)&&(i._dirty=!1)})}),t.preview.bind("nonce-refresh",function(e){$.extend(t.settings.nonce,e)}),t.preview.send("ready",{currentUrl:t.settings.url.self,activePanels:t.settings.activePanels,activeSections:t.settings.activeSections,activeControls:t.settings.activeControls,settingValidities:t.settings.settingValidities}),setInterval(t.keepAliveCurrentUrl,t.settings.timeouts.keepAliveSend),t.preview.bind("loading-initiated",function(){$("body").addClass("wp-customizer-unloading")}),t.preview.bind("loading-failed",function(){$("body").removeClass("wp-customizer-unloading")}),e=$.map(["color","image","preset","position_x","position_y","size","repeat","attachment"],function(e){return"background_"+e}),t.when.apply(t,e).done(function(){$.each(arguments,function(){this.bind(t.settingPreviewHandlers.background)})}),t("custom_logo",function(e){t.settingPreviewHandlers.custom_logo.call(e,e.get()),e.bind(t.settingPreviewHandlers.custom_logo)}),t("custom_css["+t.settings.theme.stylesheet+"]",function(e){e.bind(t.settingPreviewHandlers.custom_css)}),t.trigger("preview-ready"))})}(wp,jQuery);